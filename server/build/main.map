{"version":3,"sources":["webpack:///webpack/bootstrap 46591bcb57f94937b416","webpack:///./src/service/DataService.js","webpack:///./src/index.js","webpack:///external \"ws\"","webpack:///./src/service/GlobalEmitService.js","webpack:///external \"fs\"","webpack:///external \"path\"","webpack:///./src/controller/ConnectController.js","webpack:///external \"node-uuid\"","webpack:///./src/service/MessageDispatchService.js","webpack:///./src/service/RoomService.js","webpack:///./src/service/UserService.js","webpack:///./src/service/GameService.js","webpack:///./src/service/SenderService.js"],"names":["getRandomArray","array","sort","parseInt","Math","random","projectRoot","path","resolve","__dirname","wordData","fs","readFileSync","nickNameData","allWord","split","allNameArray","keyIndex","nameIndex","allKeys","map","w","allNames","console","log","length","getNextKey","keyWord","getNextName","wsServer","ws","Server","port","globalMap","userMap","roomMap","roomUser","gameMap","deleteExpireUser","allUsers","Object","values","nowTime","Date","getTime","forEach","u","isOnline","timeNotTouch","lastLoginTime","inGame","currentRoomId","token","username","setInterval","on","options","events","global","$on","type","fn","allFunction","push","$emit","data","ConnectController","uuid","v4","id","send","SenderService","sendToUser","userClient","message","messageData","JSON","parse","processFunction","MessageDispatchService","buildContext","e","error","currentUsers","currentRoom","currentGame","lastActiveTime","userArray","sendError","sendToUserError","sendToSameRoom","users","keys","sessionUser","k","sendToUsers","login","UserService","changename","changeName","createRoom","RoomService","create","enterRoom","enter","leaveRoom","leave","roomList","list","enterIndex","changeSub","leaveIndex","changeUnSub","chatMsg","GameService","msg","beginGame","begin","gameData","getData","drawAction","drawImage","userNumber","default","roomId","getRoomId","date","start","getDate","getHours","getMinutes","getUserArray","userLeave","ctx","status","joined","roomChangeData","sendUserNumber","sendToSub","room","user","onlineUserNumber","filter","rooms","a","b","createTime","name","playNumber","playTimes","gameTime","roomUsers","isReLink","loginUser","offLineUser","DataService","firstScroe","sencondScore","minScore","getGameKey","findNextUser","playInfo","currentTimes","userDraw","currentPlayer","player","onLineUsers","getOnlineUser","gameOver","key","play","imageData","nextPlayer","every","index","time","toNextPlayer","clearTimeout","timer","setTimeout","isOver","userScore","timeCountDown","sendType","isAllFinish","scoreMap","onlineUsers","answerNumber","countScore","score","uid","startGame","scoreKey","currentUserId","halfTime","sendAnswer","currentKey","exports","readyState","OPEN","stringify","userClients","client"],"mappings":"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","file":"main.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 1);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 46591bcb57f94937b416","import fs from 'fs'\nimport path from 'path'\n\nfunction getRandomArray(array) {\n  if (array) {\n    return array.sort(_ => {\n      return (parseInt(Math.random() * 1000) % 2) ? 1 : -1\n    })\n  }\n  return array\n}\n\nconst projectRoot = path.resolve(__dirname, '../')\nconst wordData = fs.readFileSync(projectRoot + '/word.txt','utf-8')\nconst nickNameData = fs.readFileSync(projectRoot + '/nickname.txt', 'utf-8')\nconst allWord = wordData.split('\\n')\nconst allNameArray = nickNameData.split('\\n')\nlet keyIndex = 0\nlet nameIndex = 0\n\nlet allKeys = allWord.map(w => {\n  return w.split(':')\n})\n\nlet allNames = getRandomArray(allNameArray)\nallKeys = getRandomArray(allKeys)\n\n\nconsole.log('projectRoot:', projectRoot)\nconsole.log('allGameKeyLength: ', allKeys.length)\nconsole.log('allNameLength: ', allNames.length)\nexport default {\n  getNextKey () {\n    let keyWord = allKeys[keyIndex++]\n    if (!keyWord) {\n      allKeys = getRandomArray(allKeys)\n      keyIndex = 0\n      keyWord = allKeys[keyIndex++]\n    }\n    return keyWord\n  },\n  getNextName () {\n    let keyWord = allNames[nameIndex++]\n    if (!keyWord) {\n      allNames = getRandomArray(allNames)\n      nameIndex = 0\n      keyWord = allNames[nameIndex++]\n    }\n    return keyWord\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/service/DataService.js","import ws from 'ws'\nimport GlobalEmitService from './service/GlobalEmitService'\nimport DataService from './service/DataService'\nimport ConnectController from './controller/ConnectController'\nconst wsServer = ws.Server({ port: 9001 })\nconst globalMap = {\n  userMap: {},\n  roomMap: {},\n  roomUser: {},\n  gameMap: {}\n}\n\nfunction deleteExpireUser () {\n  const allUsers = Object.values(globalMap.userMap)\n  const nowTime = new Date().getTime()\n  allUsers.forEach(u => {\n    if (!u.isOnline) {\n      const timeNotTouch = nowTime - u.lastLoginTime\n      if (timeNotTouch > 1000 * 60 * 60 * 2) {\n        console.log('user not touch ', timeNotTouch)\n        u.inGame = false\n        u.currentRoomId = ''\n        delete globalMap.userMap[u.token]\n        console.log('delete user from userMap: ', u.username)\n      }\n    }\n  })\n}\n\nsetInterval(_ => {\n  deleteExpireUser()\n}, 100000)\n\nwsServer.on('connection', ws => {\n  new ConnectController(ws, globalMap)\n})\n\nconsole.log('websocket start:', wsServer.options.port)\n\n\n\n// WEBPACK FOOTER //\n// ./src/index.js","module.exports = require(\"ws\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"ws\"\n// module id = 3\n// module chunks = 0","const events = {}\n\nglobal.$on = (type, fn) => {\n  if (typeof fn === 'function') {\n    const allFunction = events[type] || []\n    allFunction.push(fn)\n    events[type] = allFunction\n  }\n}\n\nglobal.$emit = (type, data) => {\n  const allFunction = events[type] || []\n  allFunction.forEach(fn => fn(data))\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/service/GlobalEmitService.js","module.exports = require(\"fs\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"fs\"\n// module id = 5\n// module chunks = 0","module.exports = require(\"path\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"path\"\n// module id = 6\n// module chunks = 0","import uuid from 'node-uuid'\nimport MessageDispatchService from '../service/MessageDispatchService'\nimport SenderService from '../service/SenderService'\nexport default class ConnectController {\n  constructor (ws, globalMap) {\n    this.token = uuid.v4()\n    this.id = uuid.v4()\n    this.username = ''\n    this.currentRoomId = null\n    this.isOnline = true\n    this.ws = ws\n    this.lastLoginTime = new Date().getTime()\n    this.send = (data, type) => {\n      SenderService.sendToUser(this, data, type)\n    }\n    const userClient = this\n    ws.on('message', (message) => {\n      try{\n        userClient.lastLoginTime = new Date().getTime()\n        const messageData = JSON.parse(message)\n        const processFunction = MessageDispatchService[messageData.type] || MessageDispatchService['default']\n        processFunction(buildContext(messageData, globalMap, userClient))\n      } catch (e) {\n        console.error('parse message error', message, e)\n      }\n    })\n\n    ws.on('close', _ => {\n      this.isOnline = false\n      global.$emit('userLeave', buildContext({type: 'userLeave'}, globalMap, userClient))\n    })\n\n    ws.on('error', _ => {\n      console.log('ws error')\n    })\n    function buildContext (messageData, globalMap, userClient) {\n      const currentUsers = globalMap.roomUser[userClient.currentRoomId];\n      const currentRoom = globalMap.roomMap[userClient.currentRoomId]\n      const currentGame = globalMap.gameMap[userClient.currentRoomId]\n      if (currentRoom) {\n        currentRoom.lastActiveTime = new Date().getTime()\n      }\n      return {\n        type: messageData.type,\n        data: messageData.data,\n        userClient: userClient,\n        ...globalMap,\n        currentRoom,\n        currentUsers,\n        currentGame,\n        userArray: currentUsers && Object.values(currentUsers),\n        send (data, type = messageData.type) {\n          SenderService.sendToUser(userClient, data, type, type === messageData.type ? messageData.id : null)\n        },\n        sendError (data, type = messageData.type) {\n          SenderService.sendToUserError(userClient, data, type, type === messageData.type ? messageData.id : null)\n        },\n        sendToSameRoom (data, type = messageData.type) {\n          const currentRoomId = userClient.currentRoomId\n          const users = globalMap.roomUser[currentRoomId]\n          Object.keys(users).forEach(k => {\n            const sessionUser = globalMap.userMap[users[k].token]\n            users[k] = sessionUser\n          })\n          SenderService.sendToUsers(users, data, type, type === messageData.type ? messageData.id : null)\n        }\n      }\n    }\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/controller/ConnectController.js","module.exports = require(\"node-uuid\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"node-uuid\"\n// module id = 8\n// module chunks = 0","import RoomService from './RoomService'\nimport UserService from './UserService'\nimport GameService from './GameService'\nexport default {\n  login: UserService.login,\n  changename: UserService.changeName,\n  createRoom: RoomService.create,\n  enterRoom: RoomService.enter,\n  leaveRoom: RoomService.leave,\n  roomList: RoomService.list,\n  enterIndex: RoomService.changeSub,\n  leaveIndex: RoomService.changeUnSub,\n  chatMsg: GameService.msg,\n  beginGame: GameService.begin,\n  gameData: GameService.getData,\n  drawAction: GameService.drawAction,\n  drawImage: GameService.drawImage,\n  userNumber: UserService.userNumber,\n  default ({ type }) {\n    console.log('unknow message', type)\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/service/MessageDispatchService.js","global.roomId = null\nfunction getRoomId() {\n  const date = new Date()\n  if (!global.roomId) {\n    const start = parseInt('' + date.getDate() + date.getHours() + date.getMinutes())\n    global.roomId = start\n  } else {\n    global.roomId += 2\n  }\n  return global.roomId\n}\nfunction getUserArray(currentUsers) {\n  return Object.values(currentUsers).map(u => {\n    return {\n      username: u.username,\n      id: u.id\n    }\n  })\n}\nfunction userLeave (ctx) {\n  const { userClient, currentUsers, roomMap, userMap, currentRoom, sendToSameRoom } = ctx\n  if (currentRoom && currentRoom.status === 1) {\n    Object.values(currentUsers).forEach(u => {\n      if (userClient.id === u.id) {\n        delete currentUsers[u.id]\n      }\n    })\n    currentRoom.joined = Object.values(currentUsers).length\n    sendToSameRoom({id: userClient.id}, 'userLeave')\n    global.$emit('room-changed', {userMap, roomChangeData: currentRoom})\n  }\n  sendUserNumber(userMap)\n}\n\nglobal.$on('userLeave', userLeave)\n\nfunction sendToSub(userMap, room, type) {\n  if (room.type === '1') {\n    Object.values(userMap).forEach(user => {\n      if (user.changeSub) {\n        user.send(room, type)\n      }\n    })\n  }\n}\n\nfunction sendUserNumber (userMap) {\n  const onlineUserNumber = Object.values(userMap).filter(u => u.isOnline).length\n  console.log('send userNumber: ', onlineUserNumber)\n  Object.values(userMap).forEach(u => {\n    console.log(u.username + ':' + u.changeSub);\n    if (u.changeSub) {\n      u.send(onlineUserNumber, 'userNumber')\n    }\n  })\n}\nglobal.$on('userLogin', ({userClient, userMap, currentUsers}) => {\n  if (currentUsers) {\n    currentUsers[userClient.id] = userClient\n  }\n  sendUserNumber(userMap)\n})\n\nglobal.$on('room-changed', ({userMap, roomChangeData}) => {\n  sendToSub(userMap, {id: roomChangeData.id, type: roomChangeData.type, joined: roomChangeData.joined, status: roomChangeData.status}, 'roomChanged')\n})\n\nglobal.$on('room-created', ({userMap, roomChangeData}) => {\n  sendToSub(userMap, roomChangeData, 'roomCreated')\n})\n\nexport default {\n  changeUnSub ({userClient}) {\n    userClient.changeSub = false\n  },\n  changeSub ({userClient}) {\n    userClient.changeSub = true\n  },\n  list ({send, roomMap, roomUser}) {\n    const rooms = Object.values(roomMap).filter(room => {\n      room.joined = Object.values(roomUser[room.id]).length\n      return room.joined > 0 && room.type === '1'\n    }).sort((a, b) => {\n      if (a.joined > b.joined) {\n        return 1\n      } else if (a.createTime > b.createTime) {\n        return 1\n      } else {\n        return 0\n      }\n    })\n    send(rooms)\n  },\n  create ({ data, userClient, roomMap, roomUser, userMap, send }) {\n    const room = {\n      id: getRoomId(),\n      name: data.name,\n      createTime: new Date().getTime(),\n      playNumber: 8,\n      playTimes: 3,\n      joined: 1,\n      type: data.type,\n      status: 1,\n      gameTime: 60\n    }\n    roomMap[room.id] = room\n    roomUser[room.id] = {}\n    send(room)\n  },\n  enter ({ data, userClient, roomMap, roomUser, send, sendToSameRoom, userMap, sendError }) {\n    const room = roomMap[data.id]\n    if (!room) {\n      return send({message: '房间不存在'}, 'roomClose')\n    }\n    const roomUsers = roomUser[room.id] || {}\n    roomUser[room.id] = roomUsers\n    const isReLink = roomUsers[userClient.id]\n    if (room.joined >= room.playNumber) {\n      return sendError({msg: '房间人数已满，不可加入'})\n    } else if (room.status === 2) {\n      return sendError({msg: '该房间游戏已开始，不可加入'})\n    } else {\n      roomUsers[userClient.id] = userClient\n      room.joined = Object.values(roomUsers).length\n      userClient.currentRoomId = room.id\n      send(room)\n      sendToSameRoom(getUserArray(roomUsers), 'userEnter')\n      if (room.joined === 1) {\n        global.$emit('room-created', {userMap, roomChangeData: room})\n      } else {\n        global.$emit('room-changed', {userMap, roomChangeData: room})\n      }\n    }\n  },\n  leave: userLeave\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/service/RoomService.js","import DataService from './DataService'\nexport default {\n  login (ctx) {\n    const { data, userClient, userMap, roomUser, send } = ctx\n    const user = data\n    const loginUser = () => {\n      const sessionUser = userClient\n      const token = sessionUser.token\n      const id = sessionUser.id\n      userMap[token] = sessionUser\n      send({\n        id: userClient.id,\n        token: sessionUser.token,\n        inGame: sessionUser.inGame,\n        currentRoomId: sessionUser.currentRoomId,\n        username: sessionUser.username\n      })\n      console.log('user login:', sessionUser.username)\n      global.$emit('userLogin', ctx)\n    }\n    if (user.token) {\n      const offLineUser = userMap[user.token]\n      if (offLineUser) {\n        userClient.username = offLineUser.username\n        userClient.token = offLineUser.token\n        userClient.id = offLineUser.id\n        userClient.inGame = offLineUser.inGame\n        userClient.currentRoomId = offLineUser.currentRoomId\n      } else {\n        userClient.username = user.username\n        userClient.token = user.token\n      }\n      loginUser()\n    } else {\n      const token = userClient.token\n      userClient.username = DataService.getNextName()\n      loginUser()\n    }\n  },\n\n  changeName ({data, userClient}) {\n    userClient.username = data.username\n  },\n\n  userNumber ({send, userMap}) {\n    send(Object.values(userMap).filter(u => u.isOnline).length)\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/service/UserService.js","import DataService from './DataService'\nconst firstScroe = 3\nconst sencondScore = 2\nconst minScore = 1\n\nfunction getGameKey () {\n  return DataService.getNextKey()\n}\n\nfunction findNextUser(ctx) {\n  const { sendToSameRoom, currentGame, currentUsers, userArray, userMap } = ctx\n  const { playInfo, users, currentTimes, playTimes, userDraw } = currentGame\n\n  const currentPlayer = playInfo.player\n  const onLineUsers = getOnlineUser(ctx)\n  if (onLineUsers.length === 0 || currentTimes >= playTimes) { // 如果在线人数为 0 或者 当前游戏次数大于等于 总游戏轮数， 游戏结束\n    gameOver(ctx)\n    return false\n  }\n  userDraw.push({\n    key: playInfo.key[0],\n    play: currentPlayer,\n    username: currentUsers[currentPlayer].username,\n    imageData: playInfo.imageData\n  })\n  let nextPlayer\n  userArray.every((u, index) => {\n    if (u.id === currentPlayer) {\n      nextPlayer = userArray[index + 1]\n      if (!nextPlayer) {  // 如果这个时候没有了，就是当前轮结束了\n        currentGame.currentTimes++\n        nextPlayer = userArray[0]\n      }\n      currentGame.playInfo = { // 重新设置当前playInfo\n        key: getGameKey(),\n        time: currentGame.gameTime,\n        player: nextPlayer.id\n      }\n      if (userMap[nextPlayer.token].isOnline) {\n        sendToSameRoom(null, 'changeGamer')\n        currentGame.start = false\n      } else {\n        findNextUser(ctx)\n      }\n      return false\n    }\n    return true\n  })\n}\n\nfunction toNextPlayer (ctx) {\n  const { sendToSameRoom, currentGame, currentUsers } = ctx\n  const { playInfo, users, currentTimes, playTimes, userDraw } = currentGame\n  clearTimeout(currentGame.timer)\n  sendToSameRoom({key: playInfo.key[0]}, 'thisOver')\n  setTimeout(_ => {\n    findNextUser(ctx)\n  }, 5000)\n}\n\nfunction gameOver (ctx) {\n  const { sendToSameRoom, currentGame, roomUser, currentRoom, roomMap, userArray } = ctx\n  currentGame.isOver = true\n  currentRoom.status = 1\n  userArray.forEach(u => {\n    u.inGame = false\n  })\n  sendToSameRoom(currentGame.userScore, 'gameOver')\n  roomUser[currentRoom.id] = {}\n}\n\nfunction timeCountDown (ctx) {\n  const { currentGame, sendToSameRoom } = ctx\n  const { playInfo } = currentGame\n  const time = playInfo.time\n  if (time > 0) {\n    playInfo.time--\n    if (!playInfo.sendType && currentGame.gameTime / 2 >= playInfo.time) {\n      playInfo.sendType = true\n      sendToSameRoom(playInfo.key[1], 'typeHints')\n    }\n    sendToSameRoom(playInfo.time, 'timeout')\n    currentGame.timer = setTimeout(_ => {\n      timeCountDown(ctx)\n    }, 1000)\n  } else {\n    toNextPlayer(ctx)\n  }\n}\nfunction isAllFinish (ctx) {\n  const {userClient, currentGame, sendToSameRoom} = ctx\n  const {userScore, currentTimes, playInfo} = currentGame\n  const scoreMap = userScore[playInfo.key[0]]\n  const onlineUsers = getOnlineUser(ctx)\n  const answerNumber = Object.keys(scoreMap).length\n  if (answerNumber >= onlineUsers.length) {\n    toNextPlayer(ctx)\n  }\n  const countScore = {}\n  Object.values(userScore).forEach(score => {\n    Object.keys(score).forEach(uid => {\n      countScore[uid] = score[uid] + (countScore[uid] || 0)\n    })\n  })\n  currentGame.countScore = countScore\n  sendToSameRoom(countScore, 'countScore')\n}\n\nfunction getOnlineUser (ctx) {\n  const {userMap, userArray} = ctx\n  return userArray.filter(u => {\n    return userMap[u.token].isOnline\n  })\n}\n\nfunction startGame (ctx) {\n  ctx.currentGame.start = true\n  timeCountDown(ctx)\n}\n\nfunction countScore (ctx) {\n  const {userClient, currentGame} = ctx\n  const {userScore, currentTimes, playInfo} = currentGame\n  const scoreKey = playInfo.key[0]\n  let scoreMap = userScore[scoreKey]\n  if (!scoreMap) {\n    scoreMap = {}\n    scoreMap[playInfo.player] = 0\n  }\n  userScore[scoreKey] = scoreMap\n  const currentUserId = userClient.id\n  if (scoreMap[currentUserId]) { // 如果已经有分数了，就返回0\n    return 0\n  }\n  const answerNumber = Object.keys(scoreMap).length\n  if (answerNumber === 1) { // 如果没有分数Map，那说明该人是第一个答对的 + `firstScroe` 分\n    scoreMap[currentUserId] = firstScroe\n    // 如果是第一个答对的，游戏时间缩小原来的 一般\n    const halfTime = currentGame.gameTime / 2\n    if (playInfo.time > halfTime) {\n      playInfo.time = halfTime\n    }\n  } else if (answerNumber === 2) { // 第二个答对的 + `sencondScore` 分\n    scoreMap[currentUserId] = sencondScore\n  } else {\n    scoreMap[currentUserId] = minScore // 第三及以后答对的 + `minScore` 分\n  }\n  scoreMap[playInfo.player] = Object.keys(scoreMap).length - 1 // 更新房主分数，当前批次，房主分数为答案总数\n  isAllFinish(ctx)  // 判断是否已经全部答完\n  return scoreMap[currentUserId]\n}\n\nfunction sendAnswer (ctx) {\n  const {data, userClient, sendToSameRoom, currentGame} = ctx\n  const {playInfo} = currentGame\n  const currentKey = playInfo.key[0]\n  const {username} = userClient\n  let msg\n  let type\n  if (currentKey === data) {\n    msg = `${username} 猜对了答案`\n    const score = countScore(ctx)\n    if (score > 0) {\n      msg += `+${score}分`\n    }\n    type = 'answer'\n  } else {\n    msg = `${username} 说: ${data}`\n  }\n  sendToSameRoom({\n    msg: msg,\n    type: type\n  }, 'receiveMsg')\n}\n\nglobal.$on('userLeave', (ctx) => {\n  const {data, userClient, sendToSameRoom, currentGame} = ctx\n  if (currentGame && !currentGame.isOver) {\n    sendToSameRoom({id: userClient.id}, 'userOffline')\n    if (getOnlineUser(ctx).length === 0) {\n      gameOver(ctx)\n    }\n  }\n})\n\nexport default {\n  msg (ctx) {\n    const {data, userClient, sendToSameRoom, currentGame} = ctx\n    const username = userClient.username\n    const msg = data\n    if (currentGame) {\n      sendAnswer(ctx)\n    } else {\n      sendToSameRoom({\n        msg: `${username} 说: ${msg}`,\n        type: 'normal'\n      }, 'receiveMsg')\n    }\n\n  },\n  begin (ctx) {\n    const {userClient, currentRoom, sendToSameRoom, userArray, gameMap, userMap} = ctx\n    if (userArray.length > 1 && userClient.id === userArray[0].id) { // 判断人数是否大于2人，并且当前人是否是房主\n      currentRoom.status = 2\n      userArray.forEach(u => u.inGame = true)\n      gameMap[currentRoom.id] = {\n        users: userArray,\n        playTimes: currentRoom.playTimes,\n        gameTime: currentRoom.gameTime,\n        userScore: {},\n        userDraw: [],\n        countScore: {},\n        currentTimes: 1,\n        playInfo: {\n          key: getGameKey(),\n          player: userArray[0].id,\n          time: currentRoom.gameTime\n        }\n      }\n      global.$emit('room-changed', {userMap, roomChangeData: {id: currentRoom.id, type: currentRoom.type, status: currentRoom.status}})\n      sendToSameRoom({id: currentRoom.id}, 'gameBegin')\n    }\n  },\n  getData (ctx) {\n    const {userClient, currentRoom, currentGame, send, data, sendError, sendToSameRoom} = ctx\n    if (!currentGame || currentGame.isOver) {\n      return sendError({type: 'gameOver', msg: '游戏已结束'})\n    }\n    if (userClient.currentRoomId === data.id) {\n      const {users, playInfo, countScore} = currentGame\n      const {player, key, time} = playInfo\n      const gameData = {\n        users: users.map(u => {\n          return {id: u.id, username: u.username, score: countScore[u.id] || 0}\n        }),\n        player: player,\n        time: time,\n        imageData: playInfo.imageData\n      }\n      if (player === userClient.id) {\n        gameData.key = key[0]\n      } else {\n        gameData.key = key[0].length + \"个字\"\n      }\n      if (!currentGame.start) {\n        startGame(ctx)\n      }\n      send(gameData)\n      sendToSameRoom({id: userClient.id}, 'userOnline')\n    } else {\n      sendError({msg: '进入游戏失败'})\n    }\n  },\n  drawAction ({sendToSameRoom, data, currentGame, userClient}) {\n    if (userClient.id === currentGame.playInfo.player) {\n      sendToSameRoom(data, 'drawAction')\n    }\n  },\n  drawImage ({sendToSameRoom, data, currentGame, userClient}) {\n    const { playInfo } = currentGame\n    if (userClient.id === playInfo.player) {\n      playInfo.imageData = data\n      sendToSameRoom(data, 'drawImage')\n    }\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/service/GameService.js","exports.send = (ws, message) => {\n  if (ws.readyState === ws.OPEN) {\n    ws.send(JSON.stringify(message))\n  } else {\n    console.log('ws is not open', ws.readyState)\n  }\n}\nexports.sendToUserError = (userClient, data, type, id) => {\n  if (userClient.isOnline) {\n    exports.send(userClient.ws, {data, type, id, error: true})\n  }\n}\n\nexports.sendToUser = (userClient, data, type, id) => {\n  if (userClient.isOnline) {\n    exports.send(userClient.ws, {data, type, id})\n  }\n}\n\nexports.sendToUsers = (userClients, data, type, id) => {\n  Object.values(userClients).forEach(client => {\n    exports.sendToUser(client, data, type, id)\n  })\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/service/SenderService.js"],"sourceRoot":""}